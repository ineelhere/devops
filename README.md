# Docker Basics

| COMMANDS                                                                              | DESCRIPTION                                                                                                                                                                                                                                                                                 |
| ------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| docker images                                                                         | list the docker images                                                                                                                                                                                                                                                                      |
| docker version                                                                        | check docker version                                                                                                                                                                                                                                                                        |
| docker info                                                                           | check docker info - also gives container and machine info                                                                                                                                                                                                                                   |
| docker container ls                                                                   | list containers                                                                                                                                                                                                                                                                             |
| docker run -it image\_name bash                                                       | run the docker image interactively with bash                                                                                                                                                                                                                                                |
| docker container run --publish 80:80 nginx                                            | Downloads nginx image and runs it on port 80. Short notation is -p. Publishing ports is always in HOST:CONTAINER format.                                                                                                                                                                    |
| docker container run --publish 80:801 --detach --name ineelhere nginx                 | downloads nginx image, names the container as "ineelhere" and runs it on port 81. By running in detached mode, we are able to have access to our command line when the container spins up and runs. Without it, we would have logs constantly fed onto the screen.                          |
| docker rm -f $(docker ps -aq)                                                         | removes or deletes all active containers                                                                                                                                                                                                                                                    |
| sudo lsof -i -P -n | grep LISTEN                                                      | check/list open ports                                                                                                                                                                                                                                                                       |
| sudo ss -tulpn | grep LISTEN                                                          | check/list open ports                                                                                                                                                                                                                                                                       |
| sudo kill $(sudo lsof -t -i:3000)                                                     | Kill/stop/close the open port                                                                                                                                                                                                                                                               |
| sudo kill $(sudo lsof -t -i:80)                                                       | Kill/stop/close the open port                                                                                                                                                                                                                                                               |
| docker container run --publish 80:80 --detach nginx                                   | downloads nginx image and runs it on port 80, but on the background                                                                                                                                                                                                                         |
| docker container ls                                                                   | list all active/running containers                                                                                                                                                                                                                                                          |
| docker container ls -a                                                                | list all containers - running and exited/stopped containers                                                                                                                                                                                                                                 |
| docker container ls --all                                                             | list all containers - running and exited/stopped containers                                                                                                                                                                                                                                 |
| docker container ls -aq                                                               | list all containers - running and exited/stopped containers - but only shows the container ids, excluding other details (quiet mode)                                                                                                                                                        |
| docker container logs conatiner\_id/name                                              | gives the logs for a specific container                                                                                                                                                                                                                                                     |
| docker container kill conatiner\_id/name                                              | kill the specific container                                                                                                                                                                                                                                                                 |
| docker container rm -f conatiner\_id/name                                             | deletes a container forcefully (ie, running container can also be deleted with this command without first stopping it)                                                                                                                                                                      |
| docker container run -p 80:80 -d nginx<br>docker container run -p 8080:80 -d nginx    | just because the containers are both listening on port 80 inside (the right number), there is no conflict because on the host they are published on 80, and 8080 separately (the left number).                                                                                              |
| docker container top conatiner\_id/name                                               | shows details of the processes running inside the container                                                                                                                                                                                                                                 |
| docker container stats                                                                | shows performance stats for all containers                                                                                                                                                                                                                                                  |
| docker container inspect conatiner\_id/name                                           | shows details of one container config - and we get back a JSON array of all the data about how this container was started.                                                                                                                                                                  |
| docker container run -it                                                              | start new container interactively                                                                                                                                                                                                                                                           |
| docker container exec -it                                                             | run additional commands in existing container                                                                                                                                                                                                                                               |
| docker container inspect --format '{{.NetworkSettings.IPAddress}}' container\_name/ID | shows the IP address for the container                                                                                                                                                                                                                                                      |
| docker network ls                                                                     | show networks<br>(bridge = default docker virtual network, which is NAT'ed behind the host IP)<br>(host = gains performance by skipping virtual networks but sacrifices the security of container model)<br>(none = removes eth0 and only leaves you with localhost interface in container) |
| docker network inspect network\_name                                                  | shows details of the network config in JSON                                                                                                                                                                                                                                                 |
| docker network create network\_name                                                   | create a network<br>(note - the network driver is builtin or some 3rd party extension that gives you virtual network features)                                                                                                                                                              |
| docker container run --detach --name new\_nginx --network ineelhere nginx             | run the nginx container in the network ineelhere - use "docker network inspect ineelhere" command to see the contaioners section - it must be updated with the name "new\_nginx"                                                                                                            |
| docker network connect ineelhere nginx                                                | connect container "nginx" to network "ineelhere". Use command "docker container inspect nginx" to see the change.                                                                                                                                                                           |

# Docker Errors and Fixes | ineelhere
**These errors were found on a ubuntu system and hence the fixes. The same fix might not be applicable to all OS/platforms**

* Got permission denied while trying to connect to the Docker daemon socket 
  - run `sudo chmod 666 /var/run/docker.sock` 
  - Enjoy!
* docker: Error response from daemon: driver failed programming external connectivity on endpoint elastic_bartik (754d6c0dd38315b4ccf410e1f318545dacefe1eabd336a7d2f6f1a8e40ca3d6a): Error starting userland proxy: listen tcp4 0.0.0.0:80: bind: address already in use. 
  - run `sudo lsof -i -P -n | grep LISTEN` or `sudo ss -tulpn | grep LISTEN` | This lists the open ports
  - run `sudo kill $(sudo lsof -t -i:<port_you_want_to_close>` | From the above list, identify the port and run this code!
  - Enjoy!

* [OCI runtime exec failed: exec failed: container_linux.go:344: starting container process](https://stackoverflow.com/questions/55378420/oci-runtime-exec-failed-exec-failed-container-linux-go344-starting-container)

## Basic hands on - 1

* docker container run -d -p 3306:3306 --name db -e MYSQL_RANDOM_ROOT_PASSWORD=yes mysql 
* docker container logs db
* look for MYSQL password generated
* docker container run -d --name webserver -p 8088:80 httpd
* docker ps
* docker container run -d --name proxy -p 80:80 nginx
* docker ps
* visit http://localhost/ (so that you know it works!)
* curl localhost:80 (basically the above step, but on terminal)
* cleanup - docker container stop db proxy webserver
* docker ps -a (look for status = exited)
* docker container ls -a (same as above)
* remove the containers - docker container rm proxy webserver db

<hr><br>

*explanations will be added later*
